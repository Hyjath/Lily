'OBSERVERA ATT KODEN I DENNA KLASS ÄR EN DEL AV GRUNDDATABASEN OCH FÅR INTE ÄNDRAS.
'ÄNDRINGAR OCH TILLÄGG I FUNKTIONALITET GÖRS I SEPARATA KLASSER OCH MODULER.
'OM DU TROTS DETTA VÄLJER ATT GÖRA ÄNDRINGAR I KODEN NEDAN GARANTERAS INTE LÄNGRE
'VERSIONS KOMPABILITET ELLER SUPPORT. //Projektgruppen LEAN
Option Explicit

'Public Function NewActivityFromInspector(ByVal Done As Integer, Optional show As Boolean = True, Optional activityType As String) As Inspector
'    On Error GoTo ErrorHandler
'    Dim oInspector As Lime.Inspector
'
'    Set oInspector = NewInspectorFromInspector("activity", show)
'
'    If Not oInspector Is Nothing Then
'        Call oInspector.Controls.SetValue("done", Done)
'        If activityType <> "" Then
'            Call oInspector.Controls.SelectOption("type", activityType)
'        End If
'        oInspector.Modified = False
'
'        If oInspector.Controls.GetValue("done", 0) = 1 Then
'            If VBA.Len(oInspector.Controls.GetValue("note", "")) > 0 Then
'                Call oInspector.Controls.SetValue("note", "")
'            End If
'        End If
'
'        'Added since we want to be to escape a newly created record.
'        'All values are "default" for user
'        oInspector.Modified = False
'    End If
'
'    Set NewActivityFromInspector = oInspector
'    Exit Function
'ErrorHandler:
'    Call UI.ShowError("ActionPadTools.NewActivityFromInspector")
'End Function

Public Function NewInspectorFromInspector(ByVal sClass As String, Optional show As Boolean = True) As Inspector
    On Error GoTo ErrorHandler
    
    Dim oClass As LDE.Class
    Dim oInspector As Lime.Inspector
    Dim oNewInspector As Lime.Inspector
    Dim oNewRecord As LDE.Record
    Dim sError As String
    
    Set oInspector = Application.ActiveInspector
        
    If Not oInspector.Controls Is Nothing Then
        If (oInspector.Record.State And lkRecordStateNew) = lkRecordStateNew Then
            On Error GoTo ErrorSaving
                'Call oInspector.Controls.Validate
                oInspector.Save (True)
            GoTo SaveOK
ErrorSaving:
                Call Lime.MessageBox(Err.Description)
                Exit Function
SaveOK:
        End If
    End If
        
    If Not Application.Classes.Exists(sClass) Then
        Call Lime.MessageBox(Localize.GetText("ActionPadTools", "i_class_missing"), vbInformation, sClass)
        Exit Function
    End If
    
    Set oClass = New LDE.Class
    Set oClass = Application.Database.Classes.Item(sClass)
    
    'Kontrollerar att det går att skapa önskat objekt från activeinspector
    Dim oExplorer As Lime.Explorer
    Dim oField As LDE.Field
            
    For Each oExplorer In oInspector.Explorers
        If oExplorer.Class Is oClass Then
            If oExplorer.Records.Owner.LinkedField.Type = lkFieldTypeLink Or oExplorer.Records.Owner.LinkedField.Type = lkFieldTypeMultiLink Then
                Set oField = oExplorer.Records.Owner.LinkedField
                Exit For
            End If
        End If
    Next oExplorer
        
    If oField Is Nothing Then
        Call Lime.MessageBox(Localize.GetText("ActionPadTools", "i_cannotcreateclass_fromclass"), vbInformation, oClass.LocalName, oInspector.Class.LocalName)
        Exit Function
    End If
    
    Set oNewRecord = New LDE.Record
    Call oNewRecord.Open(oClass)
    oNewRecord.Value(oField) = oInspector.Record.ID
    Set NewInspectorFromInspector = Application.OpenInspector(oInspector, oNewRecord, IIf(show, lkActivateExisting, lkNoActivate))

    
    
    Exit Function
ErrorHandler:
    Call UI.ShowError("ActionPadTools.NewInspectorFromInspector")
End Function

' Allow system reports to run from the Limebar
Public Sub RunSystemReports(ByVal Name As String)
    On Error GoTo ErrorHandler
    
    Dim oReportManager As SystemReportManager

    Application.MousePointer = 11
    
    Set oReportManager = New SystemReportManager
    Call oReportManager.RunReport(Name)
    
    Application.MousePointer = 0

    Exit Sub
ErrorHandler:
    Call UI.ShowError("ActionPadTools.RunSystemReports")
End Sub

Public Sub GotoURL(ByVal url As String)
    On Error GoTo ErrorHandler
    
    Application.Panes(1).url = url
    
    If Application.Panes.Visible = False Then
        Application.Panes.Visible = True
    End If

    If Not Application.Panes.ActivePane Is Application.Panes.Item(1) Then
        Set Application.Panes.ActivePane = Application.Panes.Item(1)
    End If

    Exit Sub
ErrorHandler:
    UI.ShowError ("ActionPadTools.GotoURL")
End Sub

Public Function ShowText(ByVal table As String, Optional extraFieldCondition As String, Optional extraValueCondition As Variant)
    On Error GoTo ErrorHandler
    Dim oRecord As LDE.Record
    Set oRecord = New LDE.Record
    
    Dim oFilter As LDE.filter
    Set oFilter = New LDE.filter
    
    oFilter.AddCondition "table", lkOpEqual, table
    
    If extraFieldCondition <> "" Then
        oFilter.AddCondition extraFieldCondition, lkOpEqual, extraValueCondition
        oFilter.AddOperator lkOpAnd
    End If

    oRecord.Open Database.Classes("text"), oFilter
    
    Exit Function
ErrorHandler:
    UI.ShowError ("ActionPadTools.Showtext")
    
End Function

Public Function ShowInformationWindow()
On Error GoTo ErrorHandler
    Dim d As New Dialog
    
    d.Property("url") = "file:///" & WebFolder & "information_window.html"
    d.show lkDialogHTML
    
    Exit Function
ErrorHandler:
    UI.ShowError ("ActionPadTools.ShowInformationWindow")
End Function

Public Function GetInformationWindowInfo() As String
On Error GoTo ErrorHandler
    Dim oInspector As Lime.Inspector
    Set oInspector = Application.ActiveInspector
    
    If Not oInspector Is Nothing Then
    
        Dim oRecord As LDE.Record
        Set oRecord = New LDE.Record
        
        Dim oFilter As LDE.filter
        Set oFilter = New LDE.filter
        
        oFilter.AddCondition "table", lkOpEqual, oInspector.Class.Name
        
        oRecord.Open Database.Classes("text"), oFilter
        
        GetInformationWindowInfo = oRecord.Text("text")
    Else
        GetInformationWindowInfo = ""
    End If
    
        
    Exit Function
ErrorHandler:
    UI.ShowError ("ActionPadTools.GetInfomrationWindowInfo")
End Function

Public Function GetInformationWindowHeader() As String
    On Error GoTo ErrorHandler
    Dim oInspector As Lime.Inspector
    
    
    Set oInspector = Application.ActiveInspector
    
    If Not oInspector Is Nothing Then
        
        Dim oRecord As LDE.Record
        Set oRecord = New LDE.Record
        
        Dim oFilter As LDE.filter
        Set oFilter = New LDE.filter
        
        oFilter.AddCondition "table", lkOpEqual, oInspector.Class.Name
        
        oRecord.Open Database.Classes("text"), oFilter
    
        GetInformationWindowHeader = oRecord.Text("title")
    Else
        GetInformationWindowHeader = ""
    End If
    
    Exit Function
ErrorHandler:
    UI.ShowError ("ActionPadTools.GetInformationWindowHeader")
End Function

Public Function GetBusinessStatusCounts() As Variant
    On Error GoTo ErrorHandler
    '14401 Kundkontakt
    '14901 Behovsanaly
    '15001 Offert
    '15101 Avtal
    
    Dim arrBusinessStatusCounts(0 To 3) As Variant
    Dim oFilter As New LDE.filter
    
    Call oFilter.AddCondition("businesstatus", lkOpEqual, 14401)
    arrBusinessStatusCounts(0) = "" & oFilter.HitCount(Database.Classes("business"))
    
    Call oFilter.Clear
    
    Call oFilter.AddCondition("businesstatus", lkOpEqual, 14901)
    arrBusinessStatusCounts(1) = "" & oFilter.HitCount(Database.Classes("business"))
    
    Call oFilter.Clear
    
    Call oFilter.AddCondition("businesstatus", lkOpEqual, 15001)
    arrBusinessStatusCounts(2) = "" & oFilter.HitCount(Database.Classes("business"))
    
    Call oFilter.Clear
    
    Call oFilter.AddCondition("businesstatus", lkOpEqual, 15101)
    arrBusinessStatusCounts(3) = "" & oFilter.HitCount(Database.Classes("business"))
     
    GetBusinessStatusCounts = arrBusinessStatusCounts
    
    Exit Function
ErrorHandler:
    UI.ShowError ("ActionPadTools.GetBusinessStatusCounts")
End Function

'PATTERN: PåGång - Visa ärende statist i actionpad
'END PåGång---------------------------------------------------------------------------------------------------------


