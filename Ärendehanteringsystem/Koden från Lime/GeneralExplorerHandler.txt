Option Explicit

    Private WithEvents m_Application As Lime.Application
    Private WithEvents m_Explorer As Lime.Explorer

Private Sub Class_Initialize()
    On Error GoTo ErrorHandler
    
    Set m_Application = Application
    
    If Not m_Application Is Nothing Then
        If Not m_Application.ActiveExplorer Is Nothing Then
            Set m_Explorer = m_Application.ActiveExplorer
        End If
    End If
    
    Exit Sub
ErrorHandler:
    Call UI.ShowError("GeneralExplorerHandler.Class_Initialize")
End Sub

Private Sub Class_Terminate()
    On Error GoTo ErrorHandler
    
    Set m_Application = Nothing
    
    Exit Sub
ErrorHandler:
    Call UI.ShowError("GeneralExplorerHandler.Class_Terminate")
End Sub

Private Sub m_Explorer_BeforeCommand(ByVal Command As CommandEnum, ByVal Parameter As Variant, Cancel As Boolean)
 On Error GoTo ErrorHandler

    If Not m_Explorer Is Nothing Then
        
        Select Case Command
            Case lkCommandNew
                
                If m_Explorer.Class.Name = "aoelectricity" Then
                    Call Application.MessageBox("Ett nytt Arbetsorderformulär ska skapas ifrån ett ärende i ärendefliken!", vbInformation)
                    Cancel = True
                End If
            
                If m_Explorer.Class.Name = "aoheating" Then
                    Call Application.MessageBox("Ett nytt Arbetsorderformulär ska skapas ifrån ett ärende i ärendefliken!", vbInformation)
                    Cancel = True
                End If
        End Select
    End If

    Exit Sub
ErrorHandler:
    Call UI.ShowError("GeneralExplorerHandler.m_Explorer_BeforeCommand")
End Sub

